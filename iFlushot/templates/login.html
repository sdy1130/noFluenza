{% extends "base.html" %}
{% block body %}
<section class="hero is-white is-medium">
  <nav class="navbar is-transparent">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img src="https://raw.githubusercontent.com/yanxi0830/uofthacks/master/iFlushot/media/flaskex-logo.png?token=ATBbhIeh1A7DibxTBSqBeX6L_RLYli58ks5cTJhEwA%3D%3D">
        <h6 href="/" class="subtitle"><strong>iFlushot</strong></h6>

      </a>
      <div id="navbar-burger-id" class="navbar-burger burger" data-target="navbar-menu-id">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
    <div id="navbar-menu-id" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item">
          <div class="field">
            <p class="control has-icons-left">
              <input class="login-input input is-small is-success" type="text" id="login-user" placeholder="Username">
                <span class="icon is-small is-left">
                  <i class="fa fa-user"></i>
                </span>
            </p>
          </div>
        </a>
        <a class="navbar-item">
          <div class="field">
            <p class="control has-icons-left">
              <input class="login-input input is-small is-success" type="password" id="login-pass" placeholder="Password">
                <span class="icon is-small is-left">
                  <i class="fa fa-lock"></i>
                </span>
            </p>
          </div>
        </a>
        <span class="navbar-item">
          <a id="login-button" class="button is-primary is-inverted">
            <span class="icon">
              <i class="fa fa-check"></i>
            </span>
            <span>Login</span>
          </a>
        </span>
      </div>
    </div>
  </nav>
</section>
<title>iFlushot</title>
<section class="hero is-primary is-bold is-medium">
  <div class="hero-body">
    <div class="container has-text-centered">
      <div class="columns">
        <div class="column is-auto">
          <br>
          <p class="title is-2">iFlushot</p>
          <p class="subtitle is-4"><i>Smarter way to fill your flushot form</i></p>
          <form>
            <div class="form-group">
              <label for="exampleInputEmail1">First Name</label>
              <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Last Name</label>
              <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Date of Birth</label>
              <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Age</label>
              <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Health Card Number</label>
              <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
            </div>

            <button type="submit" class="form-button button is-primary is-inverted is-outlined">Submit</button>
          </form>


        </div>
        <div class="column is-auto">
          <div id="video">
    <video autoplay="true" id="videoElement">
    </video>
            </div>
              <br>
              <a id="picture-button" class="form-button button is-primary is-inverted is-outlined">Snap</a>
              <canvas id="canvas" style="display:none;" width="300" height="300"></canvas>
              <br>
              <br>
              <i><a id="feedback" class="feedback"></a></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}
{% block scripts %}
<script type="text/javascript">
var video = document.querySelector("#videoElement");
var button = document.getElementById("picture-button");
var canvas = document.getElementById("canvas");

if (navigator.mediaDevices.getUserMedia) {
   navigator.mediaDevices.getUserMedia({video: true})
 .then(function(stream) {
   video.srcObject = stream;
   button.disabled = false;
   button.onclick = function () {
     canvas.getContext("2d").drawImage(video, 0, 0, 300, 300, 0, 0, 300, 300);
     $(function() {
        var params = {
            // Request parameters
            "language": "en",
            "detectOrientation ": "true",
        };
        // image_url = "https://raw.githubusercontent.com/yanxi0830/uofthacks/master/iFlushot/media/card.png?token=ATBbhFDsfRTM_unu2SmlXeHzR-h9g7HEks5cTKkwwA%3D%3D";

        $.ajax({
            url: "https://westcentralus.api.cognitive.microsoft.com/vision/v2.0/ocr?" + $.param(params),
            beforeSend: function(xhrObj){
                // Request headers
                xhrObj.setRequestHeader("Content-Type","application/json");
                xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","6f1ee2649c0b42129fb2775815d9c526");
            },
            type: "POST",
            // Request body
            data: '{"url":"https://raw.githubusercontent.com/yanxi0830/uofthacks/master/iFlushot/media/card.png?token=ATBbhFDsfRTM_unu2SmlXeHzR-h9g7HEks5cTKkwwA%3D%3D"}'
        })
        .done(function(data) {
            console.log(data)
            alert("success");
        })
        .fail(function() {
            alert("error");
        });
    });

     //document.getElementById('forms1').scrollIntoView();
     //var img = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
     //window.location.href=img; // it will save locally
     //alert("Done");
   }
 })
 .catch(function(err0r) {
   console.log("Something went wrong!");
 });
}
</script>

<script src="../static/js/scripts.js"></script>
{% endblock %}
